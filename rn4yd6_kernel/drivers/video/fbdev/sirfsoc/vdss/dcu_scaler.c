/*
 * CSR sirfsoc vdss core file
 *
 * Copyright (c) 2016, The Linux Foundation. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */

#include <linux/kernel.h>
#include <linux/module.h>
#include <linux/jiffies.h>
#include <linux/platform_device.h>
#include <linux/of.h>

#include <video/sirfsoc_vdss.h>
#include "dcu.h"

static struct dcu_vs_coef_set coef_set_6tap[DCU_VS_NUM_COEF_6TAP] = {
	{
		/*scaleFactor*/
		100,
		/*coefficients*/
		{
			0,	1,	2047,	0,	0,	0,
			6,	-26,	2047,	28,	-7,	0,
			13,	-51,	2045,	55,	-14,	0,
			18,	-74,	2040,	84,	-21,	1,
			24,	-96,	2033,	115,	-29,	1,
			29,	-118,	2027,	146,	-37,	1,
			33,	-138,	2017,	179,	-45,	2,
			38,	-156,	2005,	212,	-54,	3,
			42,	-174,	1992,	247,	-63,	4,
			45,	-190,	1977,	283,	-72,	5,
			49,	-205,	1960,	319,	-81,	6,
			52,	-219,	1942,	356,	-90,	7,
			54,	-232,	1922,	395,	-100,	9,
			57,	-243,	1900,	433,	-109,	10,
			59,	-253,	1876,	473,	-119,	12,
			60,	-262,	1852,	514,	-129,	13,
			61,	-271,	1826,	555,	-138,	15,
			62,	-278,	1798,	597,	-148,	17,
			63,	-284,	1769,	639,	-158,	19,
			64,	-289,	1739,	681,	-168,	21,
			64,	-294,	1707,	725,	-177,	23,
			64,	-296,	1674,	768,	-187,	25,
			63,	-298,	1641,	811,	-196,	27,
			63,	-299,	1605,	855,	-206,	30,
			62,	-299,	1568,	900,	-215,	32,
			61,	-299,	1531,	944,	-223,	34,
			60,	-298,	1493,	988,	-232,	37,
			59,	-296,	1454,	1032,	-240,	39,
			57,	-293,	1414,	1076,	-247,	41,
			55,	-289,	1375,	1119,	-255,	43,
			54,	-285,	1332,	1163,	-262,	46,
			52,	-280,	1291,	1206,	-269,	48,
			50,	-275,	1249,	1249,	-275,	50,
			48,	-269,	1206,	1291,	-280,	52,
			46,	-262,	1163,	1332,	-285,	54,
			43,	-255,	1119,	1375,	-289,	55,
			41,	-247,	1076,	1414,	-293,	57,
			39,	-240,	1032,	1454,	-296,	59,
			37,	-232,	988,	1493,	-298,	60,
			34,	-223,	944,	1531,	-299,	61,
			32,	-215,	900,	1568,	-299,	62,
			30,	-206,	855,	1605,	-299,	63,
			27,	-196,	811,	1641,	-298,	63,
			25,	-187,	768,	1674,	-296,	64,
			23,	-177,	725,	1707,	-294,	64,
			21,	-168,	681,	1739,	-289,	64,
			19,	-158,	639,	1769,	-284,	63,
			17,	-148,	597,	1798,	-278,	62,
			15,	-138,	555,	1826,	-271,	61,
			13,	-129,	514,	1852,	-262,	60,
			12,	-119,	473,	1876,	-253,	59,
			10,	-109,	433,	1900,	-243,	57,
			9,	-100,	395,	1922,	-232,	54,
			7,	-90,	356,	1942,	-219,	52,
			6,	-81,	319,	1960,	-205,	49,
			5,	-72,	283,	1977,	-190,	45,
			4,	-63,	247,	1992,	-174,	42,
			3,	-54,	212,	2005,	-156,	38,
			2,	-45,	179,	2017,	-138,	33,
			1,	-37,	146,	2027,	-118,	29,
			1,	-29,	115,	2033,	-96,	24,
			1,	-21,	84,	2040,	-74,	18,
			0,	-14,	55,	2045,   -51,    13,
			0,	-7,	28,	2047,	-26,	6
		}
	},
	{
		/*scaleFactor*/
		50,
		/*coefficients*/
		{
			0,	525,	998,	525,	0,	0,
			-3,	514,	998,	537,	3,	-1,
			-6,	503,	998,	548,	7,	-2,
			-9,	492,	998,	560,	10,	-3,
			-12,	481,	997,	572,	14,	-4,
			-14,	469,	997,	584,	18,	-6,
			-16,	458,	995,	596,	22,	-7,
			-19,	447,	994,	607,	27,	-8,
			-21,	436,	992,	619,	31,	-9,
			-23,	425,	990,	631,	36,	-11,
			-25,	414,	988,	642,	41,	-12,
			-26,	403,	985,	653,	46,	-13,
			-28,	392,	982,	665,	51,	-14,
			-29,	381,	979,	676,	57,	-16,
			-30,	370,	976,	687,	62,	-17,
			-32,	360,	972,	698,	68,	-18,
			-33,	349,	968,	709,	74,	-19,
			-34,	338,	964,	720,	80,	-20,
			-34,	328,	959,	731,	86,	-22,
			-35,	317,	954,	742,	93,	-23,
			-35,	307,	949,	752,	99,	-24,
			-36,	297,	943,	763,	106,	-25,
			-36,	287,	937,	773,	113,	-26,
			-37,	277,	932,	783,	120,	-27,
			-37,	267,	925,	793,	128,	-28,
			-37,	257,	919,	803,	135,	-29,
			-37,	247,	912,	813,	143,	-30,
			-37,	238,	905,	822,	151,	-31,
			-36,	228,	898,	831,	159,	-32,
			-36,	220,	890,	840,	167,	-33,
			-36,	210,	883,	849,	175,	-33,
			-35,	201,	874,	858,	184,	-34,
			-35,	193,	866,	866,	193,	-35,
			-34,	184,	858,	874,	201,	-35,
			-33,	175,	849,	883,	210,	-36,
			-33,	167,	840,	890,	220,	-36,
			-32,	159,	831,	898,	228,	-36,
			-31,	151,	822,	905,	238,	-37,
			-30,	143,	813,	912,	247,	-37,
			-29,	135,	803,	919,	257,	-37,
			-28,	128,	793,	925,	267,	-37,
			-27,	120,	783,	932,	277,	-37,
			-26,	113,	773,	937,	287,	-36,
			-25,	106,	763,	943,	297,	-36,
			-24,	99,	752,	949,	307,	-35,
			-23,	93,	742,	954,	317,	-35,
			-22,	86,	731,	959,	328,	-34,
			-20,	80,	720,	964,	338,	-34,
			-19,	74,	709,	968,	349,	-33,
			-18,	68,	698,	972,	360,	-32,
			-17,	62,	687,	976,	370,	-30,
			-16,	57,	676,	979,	381,	-29,
			-14,	51,	665,	982,	392,	-28,
			-13,	46,	653,	985,	403,	-26,
			-12,	41,	642,	988,	414,	-25,
			-11,	36,	631,	990,	425,	-23,
			-9,	31,	619,	992,	436,	-21,
			-8,	27,	607,	994,	447,	-19,
			-7,	22,	596,	995,	458,	-16,
			-6,	18,	584,	997,	469,	-14,
			-4,	14,	572,	997,	481,	-12,
			-3,	10,	560,	998,	492,	-9,
			-2,	7,	548,	998,	503,	-6,
			-1,	3,	537,	998,	514,	-3
		}
	},
	{
		/*scaleFactor*/
		33,
		/*coefficients*/
		{
			129,	517,	756,	517,	129,	0,
			125,	510,	756,	523,	134,	0,
			120,	504,	756,	530,	138,	0,
			116,	498,	755,	536,	143,	0,
			112,	491,	755,	542,	148,	0,
			108,	485,	754,	548,	152,	1,
			104,	478,	753,	555,	157,	1,
			100,	471,	753,	561,	162,	1,
			96,	465,	752,	567,	167,	1,
			92,	458,	751,	573,	172,	2,
			88,	452,	749,	579,	178,	2,
			85,	445,	748,	584,	183,	3,
			82,	439,	746,	590,	188,	3,
			78,	432,	745,	596,	193,	4,
			75,	425,	743,	602,	199,	4,
			71,	419,	741,	607,	205,	5,
			68,	412,	739,	613,	210,	6,
			65,	405,	737,	618,	216,	7,
			62,	398,	735,	624,	221,	8,
			59,	392,	732,	629,	227,	9,
			56,	385,	730,	634,	233,	10,
			53,	378,	727,	640,	239,	11,
			51,	372,	724,	644,	245,	12,
			48,	365,	721,	650,	251,	13,
			45,	359,	718,	654,	257,	15,
			43,	352,	715,	659,	263,	16,
			40,	345,	712,	664,	269,	18,
			38,	339,	709,	668,	275,	19,
			36,	332,	705,	673,	281,	21,
			34,	326,	701,	677,	288,	22,
			31,	319,	698,	682,	294,	24,
			29,	313,	694,	686,	300,	26,
			28,	306,	690,	690,	306,	28,
			26,	300,	686,	694,	313,	29,
			24,	294,	682,	698,	319,	31,
			22,	288,	677,	701,	326,	34,
			21,	281,	673,	705,	332,	36,
			19,	275,	668,	709,	339,	38,
			18,	269,	664,	712,	345,	40,
			16,	263,	659,	715,	352,	43,
			15,	257,	654,	718,	359,	45,
			13,	251,	650,	721,	365,	48,
			12,	245,	644,	724,	372,	51,
			11,	239,	640,	727,	378,	53,
			10,	233,	634,	730,	385,	56,
			9,	227,	629,	732,	392,	59,
			8,	221,	624,	735,	398,	62,
			7,	216,	618,	737,	405,	65,
			6,	210,	613,	739,	412,	68,
			5,	205,	607,	741,	419,	71,
			4,	199,	602,	743,	425,	75,
			4,	193,	596,	745,	432,	78,
			3,	188,	590,	746,	439,	82,
			3,	183,	584,	748,	445,	85,
			2,	178,	579,	749,	452,	88,
			2,	172,	573,	751,	458,	92,
			1,	167,	567,	752,	465,	96,
			1,	162,	561,	753,	471,	100,
			1,	157,	555,	753,	478,	104,
			1,	152,	548,	754,	485,	108,
			0,	148,	542,	755,	491,	112,
			0,	143,	536,	755,	498,	116,
			0,	138,	530,	756,	504,	120,
			0,	134,	523,	756,	510,	125
		}
	},
	{
		/*scaleFactor*/
		25,
		/*coefficients*/
		{
			179,	506,	679,	505,	179,	0,
			174,	501,	679,	510,	183,	1,
			170,	495,	678,	515,	188,	2,
			165,	490,	678,	519,	192,	4,
			161,	485,	677,	523,	197,	5,
			157,	480,	676,	528,	201,	6,
			152,	475,	676,	532,	206,	7,
			148,	469,	675,	537,	210,	9,
			144,	464,	674,	541,	215,	10,
			140,	459,	673,	545,	220,	11,
			136,	454,	671,	549,	225,	13,
			132,	449,	670,	553,	229,	15,
			128,	443,	669,	558,	234,	16,
			124,	438,	668,	561,	239,	18,
			120,	433,	666,	565,	244,	20,
			116,	427,	665,	569,	249,	22,
			113,	422,	663,	573,	254,	23,
			109,	417,	661,	577,	259,	25,
			105,	411,	660,	581,	264,	27,
			102,	406,	658,	584,	269,	29,
			98,	401,	656,	588,	274,	31,
			95,	395,	654,	592,	279,	33,
			91,	390,	652,	595,	284,	36,
			88,	384,	650,	599,	289,	38,
			85,	379,	647,	602,	295,	40,
			81,	374,	645,	605,	300,	43,
			78,	368,	643,	609,	305,	45,
			75,	363,	640,	612,	310,	48,
			72,	358,	638,	615,	315,	50,
			69,	352,	635,	618,	321,	53,
			66,	347,	633,	621,	326,	55,
			63,	342,	630,	624,	331,	58,
			61,	336,	627,	627,	336,	61,
			58,	331,	624,	630,	342,	63,
			55,	326,	621,	633,	347,	66,
			53,	321,	618,	635,	352,	69,
			50,	315,	615,	638,	358,	72,
			48,	310,	612,	640,	363,	75,
			45,	305,	609,	643,	368,	78,
			43,	300,	605,	645,	374,	81,
			40,	295,	602,	647,	379,	85,
			38,	289,	599,	650,	384,	88,
			36,	284,	595,	652,	390,	91,
			33,	279,	592,	654,	395,	95,
			31,	274,	588,	656,	401,	98,
			29,	269,	584,	658,	406,	102,
			27,	264,	581,	660,	411,	105,
			25,	259,	577,	661,	417,	109,
			23,	254,	573,	663,	422,	113,
			22,	249,	569,	665,	427,	116,
			20,	244,	565,	666,	433,	120,
			18,	239,	561,	668,	438,	124,
			16,	234,	558,	669,	443,	128,
			15,	229,	553,	670,	449,	132,
			13,	225,	549,	671,	454,	136,
			11,	220,	545,	673,	459,	140,
			10,	215,	541,	674,	464,	144,
			9,	210,	537,	675,	469,	148,
			7,	206,	532,	676,	475,	152,
			6,	201,	528,	676,	480,	157,
			5,	197,	523,	677,	485,	161,
			4,	192,	519,	678,	490,	165,
			2,	188,	515,	678,	495,	170,
			1,	183,	510,	679,	501,	174
		}
	},
	{
		/*scaleFactor*/
		20,
		/*coefficients*/
		{
			202,	499,	646,	499,	202,	0,
			197,	495,	645,	503,	206,	2,
			193,	490,	644,	507,	211,	3,
			188,	486,	644,	510,	215,	5,
			184,	481,	643,	514,	219,	7,
			180,	476,	642,	517,	224,	9,
			175,	472,	641,	521,	228,	11,
			171,	467,	640,	525,	232,	13,
			167,	462,	639,	528,	237,	15,
			162,	458,	638,	532,	241,	17,
			158,	453,	637,	535,	246,	19,
			154,	448,	636,	538,	250,	22,
			150,	444,	635,	541,	255,	23,
			146,	439,	633,	545,	259,	26,
			142,	434,	632,	548,	264,	28,
			138,	429,	631,	551,	268,	31,
			134,	425,	629,	554,	273,	33,
			130,	420,	628,	557,	278,	35,
			126,	415,	626,	561,	282,	38,
			122,	410,	625,	564,	287,	40,
			119,	406,	623,	566,	291,	43,
			115,	401,	621,	569,	296,	46,
			112,	396,	619,	572,	301,	48,
			108,	391,	617,	575,	306,	51,
			104,	386,	616,	578,	310,	54,
			101,	381,	614,	581,	315,	56,
			97,	377,	612,	583,	320,	59,
			94,	372,	610,	586,	324,	62,
			91,	367,	607,	589,	329,	65,
			87,	363,	605,	591,	334,	68,
			84,	358,	603,	593,	339,	71,
			81,	353,	601,	596,	343,	74,
			78,	348,	598,	598,	348,	78,
			74,	343,	596,	601,	353,	81,
			71,	339,	593,	603,	358,	84,
			68,	334,	591,	605,	363,	87,
			65,	329,	589,	607,	367,	91,
			62,	324,	586,	610,	372,	94,
			59,	320,	583,	612,	377,	97,
			56,	315,	581,	614,	381,	101,
			54,	310,	578,	616,	386,	104,
			51,	306,	575,	617,	391,	108,
			48,	301,	572,	619,	396,	112,
			46,	296,	569,	621,	401,	115,
			43,	291,	566,	623,	406,	119,
			40,	287,	564,	625,	410,	122,
			38,	282,	561,	626,	415,	126,
			35,	278,	557,	628,	420,	130,
			33,	273,	554,	629,	425,	134,
			31,	268,	551,	631,	429,	138,
			28,	264,	548,	632,	434,	142,
			26,	259,	545,	633,	439,	146,
			23,	255,	541,	635,	444,	150,
			22,	250,	538,	636,	448,	154,
			19,	246,	535,	637,	453,	158,
			17,	241,	532,	638,	458,	162,
			15,	237,	528,	639,	462,	167,
			13,	232,	525,	640,	467,	171,
			11,	228,	521,	641,	472,	175,
			9,	224,	517,	642,	476,	180,
			7,	219,	514,	643,	481,	184,
			5,	215,	510,	644,	486,	188,
			3,	211,	507,	644,	490,	193,
			2,	206,	503,	645,	495,	197
		}
	}
};

static struct dcu_vs_coef_set coef_set_12tap[DCU_VS_NUM_COEF_12TAP] = {
	{
		/*scaleFactor*/
		33,
		/*coefficients*/
		{
			534,	231,	0,	-58,	-21,	0,
			542,	241,	4,	-58,	-23,	0,
			550,	250,	9,	-58,	-24,	0,
			558,	260,	14,	-59,	-25,	0,
			565,	269,	19,	-58,	-27,	0,
			572,	279,	25,	-58,	-28,	0,
			580,	289,	30,	-58,	-29,	-1,
			586,	299,	36,	-58,	-31,	-1,
			593,	308,	42,	-57,	-32,	-1,
			600,	318,	48,	-57,	-34,	-2,
			606,	328,	54,	-56,	-35,	-2,
			612,	338,	60,	-55,	-36,	-3,
			618,	348,	67,	-54,	-38,	-3,
			623,	358,	74,	-53,	-39,	-3,
			629,	368,	81,	-52,	-40,	-4,
			633,	378,	88,	-50,	-42,	-5,
			638,	388,	95,	-49,	-43,	-5,
			643,	397,	103,	-47,	-44,	-6,
			647,	407,	110,	-45,	-46,	-7,
			651,	417,	118,	-43,	-47,	-8,
			655,	426,	126,	-41,	-48,	-8,
			658,	436,	134,	-38,	-49,	-9,
			661,	445,	142,	-35,	-50,	-10,
			664,	455,	151,	-33,	-51,	-11,
			666,	464,	159,	-30,	-52,	-12,
			669,	473,	168,	-27,	-53,	-13,
			671,	482,	176,	-24,	-54,	-14,
			672,	491,	185,	-20,	-55,	-15,
			674,	500,	194,	-16,	-56,	-16,
			675,	509,	203,	-13,	-56,	-18,
			676,	517,	213,	-9,	-57,	-19,
			676,	526,	222,	-4,	-58,	-20,
			-21,	-58,	0,	231,	534,	676,
			-20,	-58,	-4,	222,	526,	676,
			-19,	-57,	-9,	213,	517,	676,
			-18,	-56,	-13,	203,	509,	675,
			-16,	-56,	-16,	194,	500,	674,
			-15,	-55,	-20,	185,	491,	672,
			-14,	-54,	-24,	176,	482,	671,
			-13,	-53,	-27,	168,	473,	669,
			-12,	-52,	-30,	159,	464,	666,
			-11,	-51,	-33,	151,	455,	664,
			-10,	-50,	-35,	142,	445,	661,
			-9,	-49,	-38,	134,	436,	658,
			-8,	-48,	-41,	126,	426,	655,
			-8,	-47,	-43,	118,	417,	651,
			-7,	-46,	-45,	110,	407,	647,
			-6,	-44,	-47,	103,	397,	643,
			-5,	-43,	-49,	95,	388,	638,
			-5,	-42,	-50,	88,	378,	633,
			-4,	-40,	-52,	81,	368,	629,
			-3,	-39,	-53,	74,	358,	623,
			-3,	-38,	-54,	67,	348,	618,
			-3,	-36,	-55,	60,	338,	612,
			-2,	-35,	-56,	54,	328,	606,
			-2,	-34,	-57,	48,	318,	600,
			-1,	-32,	-57,	42,	308,	593,
			-1,	-31,	-58,	36,	299,	586,
			-1,	-29,	-58,	30,	289,	580,
			0,	-28,	-58,	25,	279,	572,
			0,	-27,	-58,	19,	269,	565,
			0,	-25,	-59,	14,	260,	558,
			0,	-24,	-58,	9,	250,	550,
			0,	-23,	-58,	4,	241,	542
		}
	},
	{
		/*scaleFactor*/
		25,
		/*coefficients*/
		{
			431,	264,	96,	0,	-18,	0,
			435,	270,	100,	2,	-17,	-1,
			439,	276,	105,	3,	-18,	-1,
			443,	281,	109,	5,	-18,	-2,
			447,	287,	114,	7,	-18,	-2,
			451,	293,	119,	9,	-18,	-3,
			455,	299,	123,	11,	-18,	-4,
			458,	305,	128,	13,	-18,	-4,
			461,	310,	133,	16,	-18,	-5,
			465,	316,	138,	18,	-18,	-5,
			468,	322,	143,	20,	-18,	-6,
			471,	327,	148,	23,	-18,	-7,
			474,	333,	153,	25,	-18,	-7,
			477,	338,	159,	28,	-18,	-8,
			479,	344,	164,	31,	-17,	-8,
			482,	349,	169,	34,	-17,	-9,
			484,	355,	174,	37,	-16,	-10,
			486,	360,	180,	40,	-16,	-10,
			488,	365,	185,	43,	-15,	-11,
			490,	371,	191,	46,	-15,	-11,
			492,	376,	196,	50,	-14,	-12,
			494,	381,	202,	53,	-13,	-13,
			495,	386,	207,	56,	-12,	-13,
			496,	391,	213,	60,	-12,	-14,
			497,	395,	219,	64,	-10,	-14,
			499,	400,	224,	67,	-9,	-15,
			499,	405,	230,	71,	-8,	-15,
			500,	409,	235,	75,	-7,	-15,
			501,	414,	241,	79,	-6,	-16,
			501,	419,	247,	83,	-4,	-16,
			501,	423,	253,	87,	-3,	-17,
			501,	427,	258,	92,	-2,	-17,
			-17,	0,	96,	264,	431,	501,
			-17,	-2,	92,	258,	427,	501,
			-17,	-3,	87,	253,	423,	501,
			-16,	-4,	83,	247,	419,	501,
			-16,	-6,	79,	241,	414,	501,
			-15,	-7,	75,	235,	409,	500,
			-15,	-8,	71,	230,	405,	499,
			-15,	-9,	67,	224,	400,	499,
			-14,	-10,	64,	219,	395,	497,
			-14,	-12,	60,	213,	391,	496,
			-13,	-12,	56,	207,	386,	495,
			-13,	-13,	53,	202,	381,	494,
			-12,	-14,	50,	196,	376,	492,
			-11,	-15,	46,	191,	371,	490,
			-11,	-15,	43,	185,	365,	488,
			-10,	-16,	40,	180,	360,	486,
			-10,	-16,	37,	174,	355,	484,
			-9,	-17,	34,	169,	349,	482,
			-8,	-17,	31,	164,	344,	479,
			-8,	-18,	28,	159,	338,	477,
			-7,	-18,	25,	153,	333,	474,
			-7,	-18,	23,	148,	327,	471,
			-6,	-18,	20,	143,	322,	468,
			-5,	-18,	18,	138,	316,	465,
			-5,	-18,	16,	133,	310,	461,
			-4,	-18,	13,	128,	305,	458,
			-4,	-18,	11,	123,	299,	455,
			-3,	-18,	9,	119,	293,	451,
			-2,	-18,	7,	114,	287,	447,
			-2,	-18,	5,	109,	281,	443,
			-1,	-18,	3,	105,	276,	439,
			-1,	-17,	2,	100,	270,	435
		}
	},
	{
		/*scaleFactor*/
		20,
		/*coefficients*/
		{
			375,	263,	135,	41,	0,	0,
			378,	267,	139,	43,	0,	0,
			381,	271,	142,	45,	1,	-1,
			383,	275,	146,	47,	2,	-1,
			386,	279,	150,	49,	2,	-1,
			388,	283,	154,	52,	3,	-1,
			390,	287,	158,	54,	4,	-2,
			393,	291,	162,	57,	5,	-2,
			395,	295,	166,	59,	5,	-2,
			397,	299,	169,	62,	6,	-2,
			399,	303,	174,	65,	7,	-3,
			401,	307,	177,	67,	8,	-3,
			403,	310,	182,	70,	9,	-3,
			404,	314,	185,	73,	10,	-3,
			406,	318,	189,	76,	11,	-3,
			408,	321,	194,	79,	13,	-3,
			409,	325,	198,	81,	14,	-3,
			410,	329,	202,	85,	15,	-3,
			412,	332,	206,	88,	16,	-3,
			413,	336,	210,	91,	18,	-3,
			414,	339,	214,	94,	19,	-3,
			415,	343,	218,	97,	21,	-3,
			416,	346,	222,	100,	22,	-3,
			417,	349,	226,	104,	24,	-3,
			418,	352,	230,	107,	26,	-3,
			418,	355,	235,	110,	27,	-3,
			419,	358,	239,	114,	29,	-2,
			419,	361,	243,	117,	31,	-2,
			420,	364,	247,	121,	33,	-2,
			420,	367,	251,	124,	35,	-1,
			420,	370,	255,	128,	37,	-1,
			420,	373,	259,	131,	39,	-1,
			0,	41,	135,	263,	375,	420,
			-1,	39,	131,	259,	373,	420,
			-1,	37,	128,	255,	370,	420,
			-1,	35,	124,	251,	367,	420,
			-2,	33,	121,	247,	364,	420,
			-2,	31,	117,	243,	361,	419,
			-2,	29,	114,	239,	358,	419,
			-3,	27,	110,	235,	355,	418,
			-3,	26,	107,	230,	352,	418,
			-3,	24,	104,	226,	349,	417,
			-3,	22,	100,	222,	346,	416,
			-3,	21,	97,	218,	343,	415,
			-3,	19,	94,	214,	339,	414,
			-3,	18,	91,	210,	336,	413,
			-3,	16,	88,	206,	332,	412,
			-3,	15,	85,	202,	329,	410,
			-3,	14,	81,	198,	325,	409,
			-3,	13,	79,	194,	321,	408,
			-3,	11,	76,	189,	318,	406,
			-3,	10,	73,	185,	314,	404,
			-3,	9,	70,	182,	310,	403,
			-3,	8,	67,	177,	307,	401,
			-3,	7,	65,	174,	303,	399,
			-2,	6,	62,	169,	299,	397,
			-2,	5,	59,	166,	295,	395,
			-2,	5,	57,	162,	291,	393,
			-2,	4,	54,	158,	287,	390,
			-1,	3,	52,	154,	283,	388,
			-1,	2,	49,	150,	279,	386,
			-1,	2,	47,	146,	275,	383,
			-1,	1,	45,	142,	271,	381,
			0,	0,	43,	139,	267,	378
		}
	}
};

static struct dcu_vs_interp_info interp_info[DCU_VS_NUM_INTERP] = {
	/*corresponds to DCU_VS_6_TAP_INTERPOLATOR*/
	{
		6,
		64,
		0,
		-4,
		coef_set_6tap,
		DCU_VS_NUM_COEF_6TAP,
	},
	/*corresponds to DCU_VS_12_TAP_INTERPOLATOR*/
	{
		12,
		32,
		0,
		-7,
		coef_set_12tap,
		DCU_VS_NUM_COEF_12TAP,
	}
};

static enum dcu_vs_interp vs_interp;
static u32 vs_coef_factor;

struct dcu_vs_coef_set *__dcu_vs_get_bestcoefset(
	struct dcu_vs_coef_set *coef_set,
	u32 coef_set_num,
	u32 required_factor)
{
	u32	coef_set_idx;
	s32	abs_factor_margin = 0;
	u32	min_abs_factor_margin = 0xffffffff;
	struct dcu_vs_coef_set	*best_coef_set = NULL;

	for (coef_set_idx = 0; coef_set_idx < coef_set_num;
		coef_set_idx++, coef_set++) {
		abs_factor_margin = required_factor - coef_set->scaling_factor;

		if (abs_factor_margin < 0)
			abs_factor_margin *= -1;

		if (0 == coef_set_idx ||
			abs_factor_margin < min_abs_factor_margin) {
			min_abs_factor_margin = abs_factor_margin;
			best_coef_set = coef_set;
		}
	}

	return best_coef_set;
}

bool dcu_vs_load_coefset(struct dcu_param_set *dcu_param_set)
{
	s16 *coef_item;
	u32 i, coef_val1, coef_val2;
	struct dcu_vs_coef_set	*coef_set = NULL;
	struct dcu_vs_params	*vs_params = &dcu_param_set->vs_params;

	if ((vs_params->interp < 0) ||
		(vs_params->interp >= DCU_VS_NUM_INTERP)) {
		dcu_err("Failed at %s, line %d\n", __func__, __LINE__);
		return false;
	}

	if (vs_params->interp != vs_interp ||
		vs_params->coef_scaling_factor != vs_coef_factor) {
		coef_set = __dcu_vs_get_bestcoefset(
			interp_info[vs_params->interp].coef_set,
			interp_info[vs_params->interp].coef_set_num,
			vs_params->scaling_factor);
	}

	if (NULL != coef_set) {
		coef_item = coef_set->coef;
		for (i = 0; i < DCU_VS_NUM_COEF_PHASE; i++) {
			coef_val1 = coef_item[i*6 + 0] & 0xFFF;
			coef_val2 = coef_item[i*6 + 1] & 0xFFF;
			dcu_write_reg(dcu_param_set->core_iomem,
				DCU_VS_LUM_V_COEF_RAM01_START + i * 4,
				(coef_val2 << 16) + coef_val1);
			coef_val1 = coef_item[i*6 + 2] & 0xFFF;
			coef_val2 = coef_item[i*6 + 3] & 0xFFF;
			dcu_write_reg(dcu_param_set->core_iomem,
				DCU_VS_LUM_V_COEF_RAM23_START + i * 4,
				(coef_val2 << 16) + coef_val1);
			coef_val1 = coef_item[i*6 + 4] & 0xFFF;
			coef_val2 = coef_item[i*6 + 5] & 0xFFF;
			dcu_write_reg(dcu_param_set->core_iomem,
				DCU_VS_LUM_V_COEF_RAM45_START + i * 4,
				(coef_val2 << 16) + coef_val1);
		}

		vs_interp = vs_params->interp;
		vs_coef_factor = coef_set->scaling_factor;
	}

	return true;
}

bool dcu_vs_calc_params(struct dcu_param_set *dcu_param_set)
{
	struct dcu_vs_params *vs_params;
	struct dcu_vs_coef_set	*coef_set;
	struct dcu_vs_interp_info *interp;

	vs_params = &dcu_param_set->vs_params;
	vs_params->scaling_factor = vs_params->output_height *
					100 / vs_params->clip_height;

	vs_params->interp = DCU_VS_6_TAP_INTERP;
	if (vs_params->scaling_factor <= DCU_VS_SMALL_VSF_TH)
		if (vs_params->output_width <= DCU_VS_MAX_STRIP_SIZE_SMALL_VSF)
			vs_params->interp = DCU_VS_12_TAP_INTERP;

	coef_set =  __dcu_vs_get_bestcoefset(
			interp_info[vs_params->interp].coef_set,
			interp_info[vs_params->interp].coef_set_num,
			vs_params->scaling_factor);

	if (NULL != coef_set)
		vs_params->coef_scaling_factor = coef_set->scaling_factor;

	interp = &interp_info[vs_params->interp];
	vs_params->num_tap = interp->num_tap;
	vs_params->num_phase = interp->num_phase;
	vs_params->init_phase = interp->init_phase;
	vs_params->start_line = interp->start_line;
	vs_params->frac_offset = (0 == vs_params->init_phase) ?
		0 : (vs_params->num_phase - vs_params->init_phase);

	/*Set DDA parameters*/
	vs_params->scale_factor = vs_params->num_phase *
		vs_params->clip_height / vs_params->output_height;
	vs_params->under_shoot = (vs_params->scale_factor *
				(vs_params->output_height >> 1) -
				vs_params->num_phase *
				(vs_params->clip_height >> 1)) & 0x3fff;
	vs_params->over_shoot = (vs_params->output_height >> 1) *
				(vs_params->scale_factor + 1) -
				(vs_params->clip_height >> 1) *
				vs_params->num_phase;
	vs_params->left_strip_size = vs_params->clip_width;

	return true;
}

void dcu_vs_reset(struct dcu_param_set *dcu_param_set)
{
	dcu_write_reg(dcu_param_set->core_iomem, DCU_VS_WRITEBACK_CFG, 0x0);
}

void dcu_vs_init(struct dcu_param_set *dcu_param_set)
{
	dcu_vs_reset(dcu_param_set);
	vs_interp = DCU_VS_NUM_INTERP;
	vs_coef_factor = 0;
}
